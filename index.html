<!DOCTYPE html> 

<html>
	<head>
		<title>logger</title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" type="text/css" href="css/fullcalendar.css" />
		
		<script type="text/javascript" src="js/heartcode-canvasloader.js"></script>
		
		<link rel="stylesheet" type="text/css" href="css/ui-darkness/jquery-ui-1.9.0.custom.min.css" />
		<link rel="stylesheet" type="text/css" href="css/jquery.ui.selectmenu.css" />
		
		<link rel="stylesheet" type="text/css" href="css/ui-corrections.css" />
		
		<script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.9.0.custom.min.hilight.fix.js"></script>
		<script src="js/jquery-ui-timepicker-addon.js"></script>
		<script type="text/javascript" src="js/fullcalendar.min.js"></script>
		<script type="text/javascript" src="js/date-en-GB.js"></script>
		<script type="text/javascript" src="js/date-extras.js"></script>
		
		<script type="text/javascript" src="js/jquery.ui.selectmenu.js"></script>
		
		<script type="text/javascript">
			//some constants
			var origTime = null;
			var minTime = 61*60000;
			//A multitude of widgets
			var showDisplayer = null;
			var startDateTextBox = null;
			var endDateTextBox = null;
			var eventCheck = null;
			
			var throbber = null;
			
			$(function(){

				//calendar
				
				showDisplayer = $("#calendar").fullCalendar({
					header: {
						left: "prev,next title",
						center: "",
						right: "today"
						},
					timeFormat: 'H:mm',
					axisFormat: 'HH:mm',
					defaultView: "agendaWeek",
					allDaySlot: false,
					slotMinutes: 60,
					selectable:true,
					firstDay:(new Date().getDay()+1)%7,
					theme: true,
					allDayDefault: false,
					lazyFetching:true,
					unselectAuto:false,
					//on a calender selection validate that the time is not in the past and update the time selectors
					select:function( startDate, endDate, allDay, jsEvent, view ) {
						if(endDate>(new Date()))
						{
							endDate=new Date()
							startDate = startDate>=endDate?(1).minute().ago():startDate;
							updateStartEndCal(startDate, endDate);
						}
						updateStartEndBox(startDate, endDate);
					},
					
					eventClick: function(calEvent, jsEvent, view) {
						updateStartEndCal(calEvent.start, calEvent.end);
					},
					
					loading: function(isLoading, view){
						if(!throbber) {return;}
						//isLoading?throbber.fadeIn(100):throbber.fadeOut(100);
						throbber.toggle(isLoading);
					},
					
					events:'/laconia/range/schedule/timeslot/'
				});
				
				//time pickers
				startDateTextBox = $('#startTime').datetimepicker({
					hideCalendar: true,
					altFieldTimeOnly: false,
					showButtonPanel: false,
					timeOnlyTitle: "Start Time",
					maxDateTime: (1).minute().ago(),
					
					onSelect: function(dateText, inst) {
						if (endDateTextBox.val() != '') {
							var testStartDate = startDateTextBox.datetimepicker('getDate');
							var testEndDate = endDateTextBox.datetimepicker('getDate');
							if (testStartDate >= testEndDate)
								endDateTextBox.datetimepicker('setDate', testStartDate.add(1).minute());
						}
						else {
							endDateTextBox.val(dateText);
						}
						updateStartEndBox();
						updateStartEndCal();
					}
				});
				
				
				endDateTextBox = $('#endTime').datetimepicker({
					hideCalendar: true,
					altFieldTimeOnly: false,
					showButtonPanel: false,
					timeOnlyTitle: "End Time",
					maxDateTime: (new Date()),
					
					onSelect: function(dateText, inst) {
						if (startDateTextBox.val() != '') {
							var testStartDate = startDateTextBox.datetimepicker('getDate');
							var testEndDate = endDateTextBox.datetimepicker('getDate');
							if (testStartDate >= testEndDate)
								startDateTextBox.datetimepicker('setDate', testEndDate.add(-1).minute());
						}
						else {
							startDateTextBox.val(dateText);
						}
						updateStartEndBox();
						updateStartEndCal();
					}
				});
				
				endDateTextBox.datetimepicker('setDate', (new Date()));
				startDateTextBox.datetimepicker('setDate', (1).hour().ago()); 
				updateStartEndCal();
				
				//hide-show button
				
				showDisplayer.find(".fc-header-right .ui-corner-left").removeClass("ui-corner-left");
				
				eventCheck = $(document.createElement("select"));
				
				var options = [
					{label:"None"},
					{label:"Requests"},
					{label:"Shows", select:true, event:"/laconia/range/schedule/timeslot/"}
					];
				
				for(var i = 0; i < options.length; i++)
				{
					if(!options[i].label) {continue;}
					var atr = ' value="'+(options[i].event?options[i].event:"")+'"';
					
					atr += options[i].select?' selected="selected"':"";
					
					eventCheck.prepend("<option"+atr+">"+options[i].label+"</option>");
				}
				
				showDisplayer.find(".fc-header-right").prepend(eventCheck);
				eventCheck.selectmenu({
					menuWidth: 120,
					close:function() {
						showDisplayer.find(".fc-header-right .ui-selectmenu").removeClass( "ui-corner-all" ).addClass("ui-corner-left");
					},
					open:function() {
						showDisplayer.find(".fc-header-right .ui-selectmenu").removeClass( "ui-corner-top ui-corner-left" );
					},
					
					change:updateEventCheck
				});
				showDisplayer.find(".fc-header-right .ui-selectmenu").removeClass( "ui-button ui-corner-all" ).addClass( "fc-button ui-corner-left ui-corner-tl" ).css("width", "120px");
				
				
				/*var label = $('<label for="events">Hide events</label>');
				showDisplayer.find(".fc-header-right").prepend(label);
				
				eventCheck = document.createElement("input");
				eventCheck.type="checkbox";
				eventCheck.id="events";
				eventCheck.checked=true;
				showDisplayer.find(".fc-header-right").prepend(eventCheck);
				
				eventCheck = $(eventCheck);
				eventCheck.button();
				
				label.removeClass( "ui-button ui-corner-all" ).addClass( "fc-button ui-corner-left" ).children(".ui-button-text").removeClass( "ui-button-text" ).addClass( "fc-button-content" );
				
				label.click(function(event) {
					event.stopImmediatePropagation();
					eventCheck.button( "refresh" );
				});*/
				
				//eventCheck.change(updateEventCheck);
				
				//throbber
				throbber = $('<span id="throbberCont"></span>');
				showDisplayer.find(".fc-header-right").prepend(throbber);
				throbber.hide();
				
				var throbberCan = new CanvasLoader('throbberCont', {useParent:true});
				throbberCan.setColor('#f58300'); // default is '#000000'
				throbberCan.setDiameter(25); // default is 40
				
				throbber.children().css({'padding-right': '5px', 'padding-top': '5px'});
				
				// buttons
				$("#fileType").selectmenu({
						close:function() {
							$("#fileType").selectmenu("widget").find(".ui-selectmenu").removeClass( "ui-corner-all" ).addClass("ui-corner-right");
						},
						open:function() {
							$("#fileType").selectmenu("widget").find(".ui-corner-top").removeClass( "ui-corner-top ui-corner-right" ).addClass("ui-corner-tr");
						}
					}
					
				);
				
				$("#file").addClass("ui-buttonset");
				$("#fileNameCont").button().css({"vertical-align":"top", "cursor":"text","z-index": "2"}).click(function(){$("#fileName").focus();});
				//$("#file").buttonset();
				$("#fileType").selectmenu("widget").find(".ui-selectmenu-status").css({"padding-left":"5px","padding-top":"5px"});
				$("#fileNameCont *").css({"padding-left":"0px","padding-right":"0px"});
				$("#fileName").css({"height":"1.4em","padding":"0px","border":"0px","margin-left":"0px","margin-right":"0px", "background-color":"rgba(255,255,255,0.6)"});
				
				$("#file .ui-corner-all").removeClass( "ui-corner-all" );
				
				$("#file :first").addClass("ui-corner-left");
				$("#file :last").addClass("ui-corner-right");
				
				$("#s").click(function() {
					$("body").css("background-image", "url(http://bcchang.com/immersive_blog/wp-content/uploads/2009/10/fieldstone-c.jpg)");
				})
				
				//progress
				$( "#progressbar" ).progressbar({value: 37});
				$( "#progressbar1" ).progressbar({value: 37});
				$( "#progressbar2" ).progressbar({value: 37});
			});
			
			function updateEventCheck(index, option)
			{
				showDisplayer.fullCalendar('removeEventSource');
				if(option.value)
				{
					showDisplayer.fullCalendar( 'addEventSource', option.value );
				}
				
				//eventCheck.button("option", "label", (eventCheck.is(":checked") ? "Hide" : "Show")+" events");
				//$('[for="'+eventCheck[0].id+'"]').children(".ui-button-text").removeClass( "ui-button-text" ).addClass( "fc-button-content" );
				
				//eventCheck.is(":checked")? $.rule('.event-style').append('visibility:visible') : $.rule('.event-style').append('visibility:hidden');
			}
			
			function updateStartEndBox(start, end)
			{
				start=start||startDateTextBox.datetimepicker('getDate');
				end=end||endDateTextBox.datetimepicker('getDate');
				
				startDateTextBox.datetimepicker('option', 'maxDateTime', (1).minute().ago());
				startDateTextBox.datetimepicker('option', 'timeText', start.format("%a %eS %b %Y"));
				startDateTextBox.datetimepicker('setDate', start);
				
				endDateTextBox.datetimepicker('option', 'maxDateTime', new Date());
				endDateTextBox.datetimepicker('option', 'timeText', end.format("%a %eS %b %Y"));
				endDateTextBox.datetimepicker('setDate', end);
			}
			
			function updateStartEndCal(start, end)
			{
				showDisplayer.fullCalendar( 'select', start||startDateTextBox.datetimepicker('getDate'), end||endDateTextBox.datetimepicker('getDate'), false );
			}
		</script>
	</head>
	<body>
		<div id="s" style="width:1px; height:1px; position:absolute; top:0px; left:0px;"></div>
		<div style="margin-right:auto; margin-left:auto; width:1050px; font-size: 160%;">
			<span id="startTime" style="display:inline-block; width:33%; vertical-align: top;"></span>
			<span id="endTime" style="display:inline-block; width:33%; vertical-align: top;"></span>
			
			<div id="buttons" style="display:inline-block; width:33%; vertical-align: top;">
				<div id="file">
					<div id="fileNameCont">
						<input type="text" id="fileName" name="fileName" maxlength="30"></input>
					</div>
					<select id="fileType" name="fileType">
						<option value=".mp3" selected="selected">.mp3</option>
						<option value=".flac">.flac</option>
						<option value=".ogg">.ogg</option>
					</select>
				</div>
			
			</div>
			<br>
			<br>
			<div id="progressbar"><span class="caption">Loading...please wait</span></div>
			<div id="progressbar1"><span class="caption">Loading...please wait</span></div>
			<div id="progressbar2"><span class="caption">Loading...please wait</span></div>
			<br>
			
			<div id="calendar" style=""></div>
		</div>
	</body>
</html>